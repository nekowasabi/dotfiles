# ==============================================================================
# tmux å…±é€šè¨­å®š
# å…¨ç’°å¢ƒã§å…±æœ‰ã•ã‚Œã‚‹åŸºæœ¬è¨­å®š
# ==============================================================================

# ------------------------------------------------------------------------------
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«è¨­å®š
# ------------------------------------------------------------------------------
set -ga terminal-overrides 'xterm:colors=256'
set -as terminal-features ",gnome*:RGB"
set-option -sa terminal-overrides ",xterm*:Tc"

# ------------------------------------------------------------------------------
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ã‚§ãƒ«è¨­å®š
# ------------------------------------------------------------------------------
# WSLç’°å¢ƒ(PC=wsl)ã®å ´åˆã®ã¿Nixç‰ˆzshã‚’ä½¿ç”¨
if-shell '[ "$PC" = "wsl" ]' \
    'set-option -g default-shell /home/takets/.nix-profile/bin/zsh'

# ------------------------------------------------------------------------------
# Prefix ã‚­ãƒ¼è¨­å®š
# ------------------------------------------------------------------------------
set -ga prefix ^h
unbind C-b

# ------------------------------------------------------------------------------
# åŸºæœ¬è¨­å®š
# ------------------------------------------------------------------------------
# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚’1ç§’æ¯ã«æç”»ã—ç›´ã™
set-option -g status-interval 1

# ãƒã‚¦ã‚¹æ“ä½œã‚’æœ‰åŠ¹ã«ã™ã‚‹
set-option -g mouse on

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦/ãƒšã‚¤ãƒ³ç•ªå·ã‚’1ã‹ã‚‰é–‹å§‹
set-option -g base-index 1
setw -g pane-base-index 1

# ESCã‚­ãƒ¼ã®åå¿œã‚’çŸ­ãã™ã‚‹
set -s escape-time 0

# vim/neovim ã¨ã®é€£æºã®ãŸã‚ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–
set -g focus-events on

# ------------------------------------------------------------------------------
# ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ - ãƒšã‚¤ãƒ³æ“ä½œ
# ------------------------------------------------------------------------------
# vimã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã§ãƒšã‚¤ãƒ³ã‚’ç§»å‹•ã™ã‚‹
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# vimã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã§ãƒšã‚¤ãƒ³ã‚’ãƒªã‚µã‚¤ã‚ºã™ã‚‹
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ç›´å‰ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«åˆ‡ã‚Šæ›¿ãˆ
bind C-h last-window

# ------------------------------------------------------------------------------
# ãƒšã‚¤ãƒ³ãƒœãƒ¼ãƒ€ãƒ¼è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
# ------------------------------------------------------------------------------
set -g pane-border-style fg=green,bg=default
set -g pane-active-border-style fg=white,bg=default

# ------------------------------------------------------------------------------
# ãƒšã‚¤ãƒ³èƒŒæ™¯è‰²è¨­å®šï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ»éã‚¢ã‚¯ãƒ†ã‚£ãƒ–çµ±ä¸€ï¼‰
# ------------------------------------------------------------------------------
set -g window-style 'bg=default'
set -g window-active-style 'bg=default'

# ãƒšã‚¤ãƒ³ä¸Šéƒ¨ã«Claude Codeã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¡¨ç¤º
set -g pane-border-status top
set -g pane-border-format "#[fg=colour255] #{ai_agent_status} #[default]"

# ------------------------------------------------------------------------------
# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼è¨­å®š
# ------------------------------------------------------------------------------
set -g status-style bg=default
set -g status-left-length 90
set -g status-right-length 90
set -g status-justify absolute-centre

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã®èƒŒæ™¯è‰²ãƒ»æ–‡å­—è‰²
set-option -g status-bg "colour238"
set-option -g status-fg "colour255"

# status-left ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
set-option -g status-left "#[fg=colour255,bg=colour241]Session: #S #[default]"

# status-right ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
set -g status-right "#[fg=colour255,bg=colour241] %Y%b-%d %l:%M"

# window-status ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆçµµæ–‡å­—ä»˜ãï¼‰
setenv -g FGC colour4
set -g window-status-current-format "#[fg=#{FGC}]#[fg=colour7,bg=#{FGC}]\[ğŸ‘‰#I:#W\]#[fg=#{FGC},bg=default]"
set -g window-status-format "#[fg=colour244]#[fg=default,bg=colour244]\[#I:#W\]#[fg=colour244,bg=default]"

# ------------------------------------------------------------------------------
# ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«é€šçŸ¥
# ------------------------------------------------------------------------------
setw -g monitor-activity on
set -g visual-activity on

# ------------------------------------------------------------------------------
# ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼ˆvi ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
# ------------------------------------------------------------------------------
set-window-option -g mode-keys vi
setw -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# ==============================================================================
# ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç®¡ç†ï¼ˆå…±é€šè¨­å®šï¼‰
# ==============================================================================

# TPM (Tmux Plugin Manager)
set -g @plugin 'tmux-plugins/tpm'

# Text Object ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
# set -g @plugin 'nekowasabi/tmux-text-object'
run-shell ~/repos/tmux-text-object/text_object.tmux

# Claude Code Status ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š
set -g @ai_agent_left_sep "["
set -g @ai_agent_right_sep "]"
set -g @ai_agent_working_color "#f97316"
set -g @ai_agent_idle_color "#22c55e"
set -g @ai_agent_working_threshold "10"
set -g @ai_agent_select_key "C-j"
set -g @ai_agent_fzf_preview_position "bottom"
set -g @ai_agent_fzf_preview_size "75%"


# Claude Code Status ãƒ—ãƒ©ã‚°ã‚¤ãƒ³èª­ã¿è¾¼ã¿
# set -g @plugin 'nekowasabi/tmux-claudecode-status'
run '~/repos/tmux-ai-agents-status/ai_agent_status.tmux'

set -g @plugin 'Morantron/tmux-fingers'
set -g @fingers-hint-style 'fg=red'

# Initialize TMUX plugin manager (keep this line at the very bottom of common.conf)
run '~/.tmux/plugins/tpm/tpm'
